"use strict";var ApplicationConfiguration=function(){var applicationModuleName="meanww",applicationModuleVendorDependencies=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("letters"),ApplicationConfiguration.registerModule("users"),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("admin",{url:"/admin",templateUrl:"modules/letters/views/command.html"})}]),angular.module("core").controller("HeaderController",["$scope","$location","$modal","Authentication",function($scope,$location,$modal,Authentication){$scope.authentication=Authentication,$scope.isCollapsed=!1;var isAdmin="AAA"===$scope.authentication.user.username?!0:!1;$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed},$scope.$on("$stateChangeSuccess",function(){$scope.isCollapsed=!1}),$scope.showTutorial=function(){if("/admin"===$location.path())$modal.open({templateUrl:"modules/core/views/adminTutorial.html",controller:"AdminModalController",backdrop:"static"});else if("/admin/email"===$location.path())$modal.open({templateUrl:"modules/core/views/emailTutorial.html",controller:"ModalInstanceCtrl",backdrop:"static"});else if($location.path().indexOf("/admin/email/")>=0)$modal.open({templateUrl:"modules/core/views/etemplateTutorial.html",controller:"ModalInstanceCtrl",backdrop:"static"});else if($location.path().indexOf("agency")>=0){var template=isAdmin?"modules/core/views/reviewTutorial.html":"modules/core/views/agencyTutorial.html";$modal.open({templateUrl:template,controller:"ModalInstanceCtrl",backdrop:"static"})}else $modal.open({size:"sm",templateUrl:"modules/core/views/noTutorial.html",controller:"ModalInstanceCtrl"})},isAdmin||0!==$scope.authentication.user.status||$scope.showTutorial()}]).controller("AdminModalController",["$scope","$modalInstance","$filter","Authentication","Users",function($scope,$modalInstance,$filter,Authentication,Users){function init(){$scope.user=Authentication.user,$scope.dueDate=$filter("date")($scope.user.due,"MM/dd/yy")}$scope.saveDueDate=function(){$scope.user.due=$scope.dueDate;var user=new Users($scope.user);user.$update(function(response){Authentication.user=response,init()},function(response){console.log(response.data.message)})},$scope.open=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.opened=!0},$scope.minDate=new Date,$scope.dateOptions={showWeeks:!1},$scope.exit=function(){$modalInstance.close()},init()}]).controller("ModalInstanceCtrl",["$scope","$filter","$modalInstance","Agencies",function($scope,$filter,$modalInstance,Agencies){Agencies.query(function(users){var admin=$filter("filter")(users,{username:"AAA"});$scope.dueDate=$filter("date")(admin[0].due,"fullDate")}),$scope.ok=function(){$modalInstance.close()}}]),angular.module("core").factory("Users",["$resource",function($resource){return $resource("users",{},{update:{method:"PUT"}})}]),angular.module("letters").config(["$compileProvider",function($compileProvider){$compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|blob|chrome-extension):/)}]),angular.module("letters").config(["$stateProvider",function($stateProvider){$stateProvider.state("command",{url:"/admin",templateUrl:"modules/letters/views/command.html"}).state("tracking",{url:"/admin/agency/:articleId",templateUrl:"modules/letters/views/tracking.html"}).state("agTracking",{url:"/agency/:articleId",templateUrl:"modules/letters/views/tracking.html"}).state("email",{url:"/admin/email",templateUrl:"modules/letters/views/emails.html"}).state("etemplate",{url:"/admin/email/:template",templateUrl:"modules/letters/views/etemplate.html"}).state("email-success",{url:"/admin/emails/success",templateUrl:"modules/letters/views/esent.html"}).state("stats",{url:"/admin/stats",templateUrl:"modules/letters/views/stats.html"})}]),angular.module("letters").controller("ArticlesController",["$scope","$modal","$http","$stateParams","$location","$filter","Authentication","Agencies","Articles","Users",function($scope,$modal,$http,$stateParams,$location,$filter,Authentication,Agencies){function signup(credentials){$http.post("/auth/signup",credentials).success(function(response){$scope.partners.push(response)}).error(function(response){$scope.error=response.message})}function fileInfo(e){return $scope.file=e.target.files[0],"CSV"!==$scope.file.name.split(".")[1].toUpperCase()?(alert("Must be a csv file!"),void e.target.parentNode.reset()):void(document.getElementById("filename").value=$scope.file.name)}$scope.user=Authentication.user,$scope.user||$location.path("/"),$scope.needToUpdate=!1,$scope.alert={active:!1},$scope.find=function(){$scope.partners=Agencies.query(),document.getElementById("the_file").addEventListener("change",fileInfo,!1)},$scope.handleFileSelect=function(){var file=$scope.file,reader=new FileReader;reader.onload=function(file){$scope.needToUpdate=!1;for(var content=file.target.result,rows=content.split(/[\r\n|\n]+/),headers=rows[0].split(","),required_fields=["Agency Code","Agency Name","Contact Name","Contact E-mail","Accepted Children","Accepted Teens","Accepted Seniors"],missing_fields=[],i=0;i<required_fields.length;i++)-1===headers.indexOf(required_fields[i])&&missing_fields.push(required_fields[i]);if(missing_fields.length>0)$scope.alert={active:!0,type:"danger",msg:"Your csv file could not be uploaded. It is missing the following columns: "+missing_fields.join(", ")+"."};else{for(var code_col=headers.indexOf("Agency Code"),agency_col=headers.indexOf("Agency Name"),contact_col=headers.indexOf("Contact Name"),email_col=headers.indexOf("Contact E-mail"),child_col=headers.indexOf("Accepted Children"),teen_col=headers.indexOf("Accepted Teens"),seniors_col=headers.indexOf("Accepted Seniors"),x=1;x<rows.length;x++){var record=rows[x].split(",");if(0===$filter("filter")($scope.partners,{username:record[code_col]}).length){var newPartner={username:record[code_col],agency:record[agency_col],contact:record[contact_col],email:record[email_col],children:Number(record[child_col]),teens:Number(record[teen_col]),seniors:Number(record[seniors_col])};signup(newPartner)}}$scope.alert={active:!0,type:"success",msg:"Your csv file was uploaded successfully."}}},reader.readAsText(file)},$scope.saveAgency=function(){$scope.alert.active=!1,$scope.partner.children+$scope.partner.teens+$scope.partner.seniors>0?($scope.isNewAgency?0===$filter("filter")($scope.partners,{username:$scope.partner.username}).length?signup($scope.partner):$scope.alert={active:!0,type:"danger",msg:$scope.partner.username+" already exists. Please edit the existing copy to avoid duplicates."}:$scope.partner.$update(function(partner){console.log(partner.username+" was updated")},function(errorResponse){console.log(errorResponse.data.message)}),$scope.hideSidebar()):$scope.alert={active:!0,type:"danger",msg:"A tracking form must include at least one letter."}},$scope.deleteAgency=function(selected){var confirmation=prompt("Please type DELETE to remove "+selected.agency+".");"DELETE"===confirmation&&selected.$remove(function(){$scope.partners.splice($scope.partners.indexOf(selected),1)},function(){console.log("Remove Failed")})},$scope.showSidebar=function(selected){$scope.isNewAgency=selected?!1:!0,$scope.partner=selected,$scope.needToUpdate=!0},$scope.hideSidebar=function(){$scope.partner=null,$scope.needToUpdate=!1}}]),angular.module("letters").controller("EmailsController",["$scope","$modal","$http","$stateParams","$location","$filter","Authentication","Agencies","Articles","Users",function($scope,$modal,$http,$stateParams,$location,$filter,Authentication,Agencies,Articles,Users){$scope.user=Authentication.user,$scope.user||$location.path("/"),$scope.etemplate=$filter("filter")($scope.user.acceptance,{title:$stateParams.template})[0];var templateIndex=$scope.user.acceptance.indexOf($scope.etemplate);$scope.needToUpdate=!1,$scope.sendEmail=function(){$scope.error=null,$scope.saveTemplate(),$http.post("/accept",$scope.user.acceptance[templateIndex]).success(function(){$location.path("/admin/emails/success")}).error(function(response){$scope.error=response.data.message})},$scope.saveTemplate=function(){$scope.success=$scope.error=null,templateIndex>-1?$scope.user.acceptance[templateIndex]=$scope.etemplate:$scope.user.acceptance.push($scope.etemplate);var user=new Users($scope.user);user.$update(function(response){$scope.user=response,$scope.success=!0,"/admin/email"===$location.path()&&$scope.hideSidebar()},function(response){$scope.error=response.data.message})},$scope.showSidebar=function(selected){$scope.etemplate=selected,templateIndex=$scope.user.acceptance.indexOf($scope.etemplate),$scope.needToUpdate=!0},$scope.hideSidebar=function(){$scope.etemplate=null,templateIndex=null,$scope.needToUpdate=!1},$scope.deleteAgency=function(selected){var confirmation=prompt("Please type DELETE to remove the "+selected.title+" template.");if("DELETE"===confirmation){$scope.user.acceptance.splice($scope.user.acceptance.indexOf(selected),1);var user=new Users($scope.user);user.$update(function(response){$scope.user=response,$scope.success=!0},function(response){$scope.error=response.data.message})}}}]),angular.module("letters").controller("SummaryController",["$scope","$window","$location","$filter","Authentication","Agencies","Articles",function($scope,$window,$location,$filter,Authentication,Agencies,Articles){$scope.authentication=Authentication,$scope.authentication.user||$location.path("/"),angular.element($window).on("resize",function(){$scope.$apply()}),$scope.partners=Agencies.query(function(){c3.generate({bindto:"#donut",data:{columns:[["NotYetStarted",$filter("filter")($scope.partners,{status:0}).length],["InProgress",$filter("filter")($scope.partners,{status:1}).length],["Submitted",$filter("filter")($scope.partners,{status:3}).length],["UnderReview",$filter("filter")($scope.partners,{status:4}).length],["Reviewed",$filter("filter")($scope.partners,{status:5}).length]],type:"donut",colors:{Reviewed:"#428bca",UnderReview:"#5bc0de",Submitted:"#5cb85c",InProgress:"#f0ad4e",NotYetStarted:"#d9534f"}},tooltip:{format:{value:function(value){return value}}},donut:{title:"Progress"}})}),$scope.letters=Articles.query(function(){var useful=$filter("filter")($scope.letters,{updated:"!null"}),counts={};useful.forEach(function(letter){var date=$filter("date")(letter.updated,"yyyy-MM-dd");counts[date]=(counts[date]||0)+1});var values=Object.keys(counts),frequency=["Wishes Added"];for(var key in counts)frequency.push(counts[key]);values.unshift("x");var wordCounts=(c3.generate({bindto:"#timeline",data:{x:"x",columns:[values,frequency]},axis:{x:{type:"timeseries",tick:{format:"%m/%d/%y"}}}}),{}),fillers=" , a, an, and, but, or, the, for, is, it, my, your, i, am, is, be, you, me, it, he, she, to, please, dont";useful.forEach(function(rec){for(var words=rec.gift.replace(/[\.,-\/#\?!$%\^&\*;:{}=\-_'"`~()]/g,"").split(/\b/),i=0;i<words.length;i++)-1===fillers.indexOf(words[i])&&(wordCounts[words[i].toLowerCase()]=(wordCounts[words[i].toLowerCase()]||0)+1)});var sortable=[];for(var word in wordCounts)sortable.push([word,wordCounts[word]]);sortable.sort(function(b,a){return a[1]-b[1]});var topTen=sortable.slice(0,10);$scope.gifts=[];for(var i=0;i<topTen.length;i++)$scope.gifts.push({name:topTen[i][0],value:topTen[i][1]})})}]),angular.module("letters").controller("AgencyController",["$scope","$stateParams","$location","$filter","$timeout","$modal","Authentication","Articles","Agencies","Users",function($scope,$stateParams,$location,$filter,$timeout,$modal,Authentication,Articles,Agencies,Users){function init(){Recipients=$filter("filter")($scope.letters,{track:$scope.currentAgency.username});var myChildren=$filter("filter")(Recipients,{track:$scope.currentAgency.username+"C"}),myTeens=$filter("filter")(Recipients,{track:$scope.currentAgency.username+"T"}),mySeniors=$filter("filter")(Recipients,{track:$scope.currentAgency.username+"S"});$scope.tabs=[{title:"Children",content:myChildren,active:!1,minAge:4,maxAge:13},{title:"Teens",content:myTeens,active:!1,minAge:14,maxAge:18},{title:"Seniors",content:mySeniors,active:!1,minAge:65,maxAge:125}],$scope.activateTab(myChildren.length>0?$scope.tabs[0]:myTeens.length>0?$scope.tabs[1]:$scope.tabs[2]),(!$scope.adminView&&$scope.currentAgency.status>=3||$scope.adminView&&5===$scope.currentAgency.status)&&downloadCSV()}function dateDiff(a,b){var MS_PER_DAY=864e5,utc1=Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()),utc2=Date.UTC(b.getFullYear(),b.getMonth(),b.getDate());return Math.floor((utc2-utc1)/MS_PER_DAY)}function updateForm(form){form&&(form.$setPristine(),form.$setUntouched()),$scope.current=$scope.recipients[currentIndex]}function isValidLetter(form){return $scope.current.name||$scope.current.age||$scope.current.gender||$scope.current.gift?$scope.current.name&&$scope.current.age&&$scope.current.gender&&$scope.current.gift?(addRecipient(form),!0):($scope.blankName=$scope.current.name?!1:!0,$scope.error="fields cannot be left blank",$timeout(function(){$scope.blankName=!1,$scope.error=null},2e3),!1):!0}function addRecipient(){if($scope.current.name=cleanText($scope.current.name,1).trim(),$scope.current.gender=$scope.current.gender.toUpperCase(),$scope.current.gift=cleanText($scope.current.gift,2),0===$scope.currentAgency.status){$scope.currentAgency.status=1;var user=new Users($scope.currentAgency);user.$update(function(response){$scope.currentAgency=response})}$scope.current.$update()}function cleanText(text,priority){return text!==text.toLowerCase()&&text!==text.toUpperCase()||1!==priority?text===text.toUpperCase()?text.toLowerCase():text:text.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()})}function downloadCSV(){var headers=["track","name","age","gender","gift"];$scope.adminView&&headers.push("flagged");for(var csvString=headers.join(",")+"\r\n",i=0;i<Recipients.length;i++)if(Recipients[i].name){for(var key in headers){var line=Recipients[i][headers[key]];4===key&&-1!==Recipients[i][headers[key]].indexOf(",")&&(line='"'+Recipients[i][headers[key]]+'"'),csvString+=line+","}csvString+="\r\n"}var date=$filter("date")(new Date,"MM-dd");$scope.fileName="WishesToSF_"+date+".csv";var blob=new Blob([csvString],{type:"text/csv;charset=UTF-8"});$scope.url=window.URL.createObjectURL(blob)}function rateAgencyToComplete(){var modalInstance=$modal.open({templateUrl:"modules/letters/views/rating.html",controller:"RatingCtrl",backdrop:"static",size:"md",resolve:{rating:function(){return $scope.currentAgency.rating}}});modalInstance.result.then(function(result){$scope.currentAgency.rating=result,$scope.currentAgency.status=5;var user=new Agencies($scope.currentAgency);user.$update(function(response){$scope.currentAgency=response,downloadCSV()},function(response){$scope.error=response.data.message})})}$scope.user=Authentication.user,$scope.user||$location.path("/"),$scope.adminView="AAA"===$scope.user.username?!0:!1,$scope.minAge=null,$scope.maxAge=null,$scope.recipients=null,$scope.tabs=[];var Recipients=null,blankRecords=null,currentIndex=0;$scope.find=function(){$scope.letters=Articles.query(function(){$scope.adminView?$scope.currentAgency=Agencies.get({agencyId:$stateParams.articleId},function(){init()}):($scope.currentAgency=$scope.user,Agencies.query(function(users){{var admin=$filter("filter")(users,{username:"AAA"});$filter("date")(admin[0].due,"MM/dd/yy")}if($scope.currentAgency.status<3){var countdown=dateDiff(new Date,new Date(admin[0].due));14===countdown?$scope.alert={active:!0,type:"warning",msg:"Two weeks left"}:7===countdown?$scope.alert={active:!0,type:"warning",msg:"One week left"}:0===countdown?$scope.alert={active:!0,type:"danger",msg:"Last day to submit"}:1===countdown?$scope.alert={active:!0,type:"danger",msg:"One day left"}:0>countdown?$scope.alert={active:!0,type:"danger",msg:"Past due -- please submit it ASAP"}:3>=countdown&&($scope.alert={active:!0,type:"danger",msg:countdown+" days left"})}init()}))})},$scope.activateTab=function(clicked,form){clicked.active=!0,$scope.recipients=clicked.content,$scope.minAge=clicked.minAge,$scope.maxAge=clicked.maxAge,blankRecords=$filter("filter")($scope.recipients,function(rec){return!rec.name}),currentIndex=blankRecords.length>0?$scope.recipients.indexOf(blankRecords[0]):0,updateForm(form)},$scope.addBlank=function(){var letter=new Articles({track:$scope.current.track});letter.$save(function(){$scope.find()},function(){console.log("response")})},$scope.clearForm=function(selected){$scope.adminView?selected.$remove(function(){$scope.find()},function(){console.log("Remove Failed")}):($scope.current.name="",$scope.current.age="",$scope.current.gender="",$scope.current.gift="",$scope.current.$update())},$scope.goToNext=function(form){isValidLetter(form)&&(currentIndex<$scope.recipients.length-1?(currentIndex++,updateForm(form)):$scope.alert={active:!0,type:"info",msg:"You just entered the last letter on this page."})},$scope.goToSelected=function(selected,form){isValidLetter(form)&&!form.$invalid&&(currentIndex=$scope.recipients.indexOf(selected),updateForm(form))},$scope.isUsed=function(form){$scope.current.name.length>0?($scope.blankName=!1,form.age.$setTouched(),form.gender.$setTouched(),form.gift.$setTouched()):form.$setUntouched()},$scope.isWithinRange=function(age){age.$setValidity("inRange",null===$scope.current.age||$scope.current.age>=$scope.minAge&&$scope.current.age<=$scope.maxAge)},$scope.confirmCompletion=function(){var user=null;if($scope.adminView)rateAgencyToComplete();else{var dblcheck=confirm("Click OK to let the Winter Wishes Team know that your tracking form is ready. You will not be able to make any further changes.");dblcheck&&($scope.currentAgency.status=3,user=new Users($scope.currentAgency),user.$update(function(response){$scope.currentAgency=response,downloadCSV()},function(response){$scope.error=response.data.message}))}},$scope.startReview=function(){$scope.currentAgency.status=4;var user=new Agencies($scope.currentAgency);user.$update(function(response){$scope.currentAgency=response},function(response){$scope.error=response.data.message})},$scope.flagLetter=function(selected){selected.flagged=!selected.flagged,selected.$update()},$scope.returnLetters=function(){$scope.currentAgency.status=1;var user=new Agencies($scope.currentAgency);user.$update(function(response){$scope.currentAgency=response},function(response){$scope.error=response.data.message})},$scope.giftReceived=function(selected){selected.received=!selected.received,selected.$update()}}]).controller("RatingCtrl",["$scope","$timeout","$modalInstance","rating",function($scope,$timeout,$modalInstance,rating){$scope.rating=rating,$scope.hoveringOver=function(value,rating){switch($scope.overStar=value,$scope.desc={percent:100*(value/5)},value){case 1:$scope.desc.words="None";break;case 2:$scope.desc.words="Scarce";break;case 3:$scope.desc.words="Some";break;case 4:$scope.desc.words="Good";break;case 5:$scope.desc.words="Great"}$scope.active=rating},$scope.updateOverall=function(){$scope.rating.overall=($scope.rating.content+$scope.rating.decoration)/2},$scope.ok=function(){$scope.rating.overall>0?$modalInstance.close($scope.rating):($scope.error="your feedback would be greatly appreciated",$timeout(function(){$scope.error=null},2e3))}}]),angular.module("letters").factory("Agencies",["$resource",function($resource){return $resource("agency/:agencyId",{agencyId:"@_id"},{update:{method:"PUT"}})}]),angular.module("letters").directive("donutChart",function(){return{restrict:"E",scope:{data:"="},link:function(scope,elem){var element=elem[0],margin={top:20,right:30,bottom:30,left:55},width=element.clientWidth-margin.left-margin.right,height=300-margin.top-margin.bottom;scope.$watch("data",function(data){if(data){var y=d3.scale.ordinal().domain(data.map(function(d){return d.name})).rangeRoundBands([height,0],.05),x=d3.scale.linear().domain([0,d3.max(data,function(d){return d.value})]).range([0,width]),yAxis=d3.svg.axis().scale(y).orient("left"),chart=d3.select(element).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");chart.append("g").attr("class","y axis").call(yAxis),chart.selectAll(".bar").data(data).enter().append("rect").attr("class","bar").attr("y",function(d){return y(d.name)}).attr("width",function(d){return x(d.value)}).attr("height",y.rangeBand()),chart.selectAll(".btext").data(data).enter().append("text").attr("class","btext").attr("x",function(d){return x(d.value)-3}).attr("y",function(d){return y(d.name)+y.rangeBand()/2}).attr("dy",".35em").text(function(d){return d.value})}},!0)}}}),angular.module("letters").factory("Articles",["$resource",function($resource){return $resource("articles/:articleId",{articleId:"@_id"},{update:{method:"PUT"}})}]),angular.module("letters").factory("Users",["$resource",function($resource){return $resource("users",{},{update:{method:"PUT"}})}]),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin");break;case 403:}return $q.reject(rejection)}}}])}]),angular.module("users").config(["$stateProvider",function($stateProvider){$stateProvider.state("profile",{url:"/settings/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("signin",{url:"/signin",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("forgot",{url:"/password/forgot",templateUrl:"modules/users/views/password/forgot-password.client.view.html"}).state("reset-invalid",{url:"/password/reset/invalid",templateUrl:"modules/users/views/password/reset-password-invalid.client.view.html"}).state("reset-success",{url:"/password/reset/success",templateUrl:"modules/users/views/password/reset-password-success.client.view.html"}).state("reset",{url:"/password/reset/:token",templateUrl:"modules/users/views/password/reset-password.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication",function($scope,$http,$location,Authentication){function redirect(user){$location.path("AAA"===user.username?"/admin":"/agency/"+user._id)}$scope.user=Authentication.user,$scope.user&&redirect($scope.user),$scope.signin=function(){$http.post("/auth/signin",$scope.credentials).success(function(response){Authentication.user=response,redirect(response)}).error(function(response){$scope.error=response.message})},$scope.signup=function(){$http.post("/auth/signup",$scope.credentials).success(function(){console.log("profile created")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function($scope,$stateParams,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.askForPasswordReset=function(){$scope.success=$scope.error=null,$http.post("/auth/forgot",$scope.credentials).success(function(response){$scope.credentials=null,$scope.success=response.message}).error(function(response){$scope.credentials=null,$scope.error=response.message})},$scope.resetUserPassword=function(){$scope.success=$scope.error=null,$http.post("/auth/reset/"+$stateParams.token,$scope.passwordDetails).success(function(response){$scope.passwordDetails=null,Authentication.user=response,$location.path("/password/reset/success")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function($scope,$http,$location,Users,Authentication){$scope.user=Authentication.user,$scope.user||$location.path("/"),$scope.updateUserProfile=function(isValid){if(isValid){$scope.success=$scope.error=null;var user=new Users($scope.user);user.$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})}else $scope.submitted=!0},$scope.changeUserPassword=function(){$scope.success=$scope.error=null,$http.post("/users/password",$scope.passwordDetails).success(function(){$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message})}}]),angular.module("users").factory("Authentication",[function(){var _this=this;return _this._data={user:window.user},_this._data}]),angular.module("users").factory("Users",["$resource",function($resource){return $resource("users",{},{update:{method:"PUT"}})}]);